# Spring Higher-Order Components
Boilerplate components for AWS and Spring Boot. 
- Sending e-mails with step builder
- Request logging 
- Uploading files to S3
- CORS [in-development]
- Simple OAuth2 configuration [soon]

## Installation
```
<dependency>
  <groupId>me.jpomykala.hoc</groupId>
  <artifactId>spring-higher-order-components</artifactId>
  <version>1.0.0</version>
</dependency>
```
## Why you should use it?
To speed up you development in next projects, instead copy-pasting good solutions between projects.

## @EnableMailing

This component give you simple API to send emails using Amazon SES service. 

### Configuration

- Provide **verified** sender email address ``spring-hoc.mail.sender-email-address``
- Provide AWS credentials ``spring-hoc.aws.access-token``, ``spring-hoc.aws.secret-key``, ``spring-hoc.aws.region``

Spring HOC will automatically create for you Amazon SES component if bean doesn't exit.

### How to send e-mail?

Use ``EmailRequest`` step builder to create request.

```
EmailRequest.builder()
            .to("hello@jpomykala.me")
            .subject("Hey, I just met you and this is crazy")
            .body("But here's my number, so call me maybe")
            .build();
```

Now it's time to send email. You have 2 options here.
- ``@Autowire MailService`` and invoke ``sendEmail(EmailRequest)``.
- Publish ``EmailRequest`` using ``ApplicationEventPublisher``

That's all!

## @EnableCors _[in-development]_

This annotation adds filter with which handle CORS. Right now you can configure only allowed origins using ``application.yml`` See example configuration below.

## @EnableRequestLogging

Adds logging requests, populate MDC with:
- user (IP address by default)
- requestId (UUID by default).

```
@Bean
public LoggingFilter loggingFilter(LoggingFilterFactory loggingFilterFactory){
  return loggingFilterFactory
          .withPrincipalProvider() // [optional] PrincipalProvider implementation 
          .withRequestIdProvider() // [optional] RequestIdProvider implementation
          .withCustomMdc("user", "[u:%s][rid:%s]") // [optional] MDC key, String.format()
          .createFilter();
}
```

## @EnableFileUploading

This annotation autoconfigures Amazon S3 component if bean doesn't exit.

``@Autowire UploadService`` gives you ability to upload files using overloaded methods:
- ``void upload(@NotNull UploadRequest uploadRequest)``
- ``void upload(@NotNull MultipartFile file)``
- ``void upload(@NotNull MultipartFile file, @NotNull String path)``
- ``void upload(byte[] bytes, String fileKey)``
- ``void upload(byte[] bytes, String fileKey, ObjectMetadata metadata)``
- ``String upload(byte[] bytes)`` // path is autogenerated and returned (SHA256)

## example ``application.yml`` configuration

```
spring-hoc:
  aws:
    access-token: xxxxxxxx
    secret-key: xxxxxxxx
    region: eu-west-1
  cors:
    allowed-origins:
      - "http://localhost:3000"
  mail:
    sender-email-address: xxxxx@xxxx.com    
```


# Contribution

Would you like to add something or improve source? Create new issue, let's discuss it 

- **If in doubt, please discuss your ideas first before providing a pull request. This often helps avoid a lot of unnecessary work. In particular, we might prefer not to prioritise a particular feature for another while.**
- Fork the repository.
- The commit message should reference the issue number.
- Check out and work on your own fork.
- Try to make your commits as atomic as possible. Related changes to three files should be committed in one commit.
- Try not to modify anything unrelated.

# More
- Follow me on [Twitter](https://twitter.com/jakub_pomykala) :)
- Check out my [website](https://jpomykala.me)

# License
GNU General Public License v3.0
